<div class="panel" *ngIf="settings$ | async as settings">
    <div *ngIf="show_toolbar" class="panel__header panel__header--tableview">
        <h5 class="panel__title">{{ 'ww.tableviewer.conj.title' | translate }}</h5>
        <div class="panel__toolbar toolbar" *ngIf="selection$ | async as selection">
            <button (click)='onManualConjugation($event)' class="conjugate mat-accent" mat-raised-button>
                {{ 'ww.tableviewer.conj.conjugate' | translate }}
            </button>
            <select *ngIf="!selection.gridView" (change)="onChangeTreeDepth($event)" class="toolbar__tool ui-button"
                [matTooltip]="'ww.tableviewer.conj.depth-tip' | translate" [matTooltipShowDelay]="showDelay.value"
                [matTooltipHideDelay]="hideDelay.value" [matTooltipPosition]="tooltipPosition">
                <option value="0">0</option>
                <option selected value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
            <button *ngIf="!selection.gridView" class="toolbar__tool ui-button" mat-icon-button
                (click)="onToggleTreeOrder()" [matTooltip]="'ww.tableviewer.conj.order-tip' | translate"
                [matTooltipShowDelay]="showDelay.value" [matTooltipHideDelay]="hideDelay.value"
                [matTooltipPosition]="tooltipPosition">
                <mat-icon aria-label="Switch pronoun and temp">swap_horiz</mat-icon>
            </button>
            <button (click)="download()" *ngIf="selection.gridView" class="ui-button toolbar__tool" mat-icon-button
                [matTooltip]="'ww.tableviewer.conj.download-tip' | translate" [matTooltipShowDelay]="showDelay.value"
                [matTooltipHideDelay]="hideDelay.value" [matTooltipPosition]="tooltipPosition">
                <mat-icon aria-label="Download conjugations">get_app</mat-icon>
            </button>
            <button class="ui-button toolbar__tool" mat-icon-button (click)="onToggleGridView()"
                [matTooltip]="'ww.tableviewer.conj.explorer-tip' | translate" [matTooltipShowDelay]="showDelay.value"
                [matTooltipHideDelay]="hideDelay.value" [matTooltipPosition]="tooltipPosition">
                <mat-icon *ngIf="selection.gridView" aria-label="Conjugate">account_tree</mat-icon>
                <mat-icon *ngIf="!selection.gridView" aria-label="Conjugate">grid_on</mat-icon>
            </button>
            <button (click)="show_toolbar = !show_toolbar" class="ui-button toolbar__tool" mat-icon-button
                [matTooltip]="'ww.tableviewer.conj.hide-toolbar-tip' | translate"
                [matTooltipShowDelay]="showDelay.value" [matTooltipHideDelay]="hideDelay.value"
                [matTooltipPosition]="tooltipPosition">
                <mat-icon aria-label="Hide toolbar">cancel</mat-icon>
            </button>
        </div>
    </div>
    <div class="panel__underline height-5">
        <hr *ngIf="show_toolbar" />
        <button *ngIf="!show_toolbar" (click)="show_toolbar = !show_toolbar" class="float-right ui-button toolbar__tool"
            mat-icon-button [matTooltip]="'ww.tableviewer.conj.show-toolbar-tip' | translate"
            [matTooltipShowDelay]="showDelay.value" [matTooltipHideDelay]="hideDelay.value"
            [matTooltipPosition]="tooltipPosition">
            <mat-icon aria-label="Show toolbar">add_circle</mat-icon>
        </button>
    </div>
    <div *ngIf="selection$ | async as selection">
        <div>
            <h3 class='center-text margin-top-50' *ngIf='selection.gridView && selection.conjugations.length === 0' [innerHTML]="'ww.tableviewer.conj.gridview' | translate"></h3>
            <h3 class='center-text margin-top-50' *ngIf='!selection.gridView && selection.conjugations.length === 0' [innerHTML]="'ww.tableviewer.conj.treeview' | translate"></h3>
            <h4 class="desktop-only center-text margin-top-50 padding-20"
                *ngIf="!selection.loading && selection.conjugations.length === 0"
                [ngClass]="routeAnimationsElements" [innerHTML]="'ww.tableviewer.conj.instructions' | translate">
            </h4>
            <h3 class="mobile-only padding-15 center-text"
                *ngIf="!selection.loading && selection.conjugations.length === 0"
                [innerHTML]="'ww.tableviewer.conj.instructions-mobile' | translate">
            </h3>
            <mat-spinner [color]="'accent'" *ngIf="selection.loading" class="centered margin-top-100"></mat-spinner>
        </div>

        <div *ngIf="!selection.gridView && selection.conjugations" [hidden]='selection.gridView'
            class="full-width full-height">
            <ww-conjugation-tree></ww-conjugation-tree>
        </div>

        <div *ngIf="!selection.loading && (gridData$ | async) as gridData;" [hidden]="!selection.gridView">
            <div id="table-container" class="rel">
                <div class="error__container" *ngIf="isString(gridData)">
                    <h3 class="error__header">
                        {{ 'ww.tableviewer.conj.error.title' | translate }}
                    </h3>
                    <p class="error__message">{{ gridData }}</p>
                    <p class="error__message">
                        {{ 'ww.tableviewer.conj.error.message' | translate }}
                    </p>
                </div>
                <table class="full-width abs" *ngIf="!isString(gridData)">
                    <thead>
                        <tr>
                            <th>
                                <h3 class='center-text'>{{ 'ww.language' | translate }}</h3>
                            </th>
                            <th *ngIf="settings.level['breakdown-translation'] || settings.level.translation">
                                <h3 class='center-text'>{{ 'ww.translation-language' | translate }}</h3>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="b--bottom" *ngFor="let conjugation of gridData">
                            <td class='center-text'>
                                <div *ngFor="let tier of conjugation; let i = index">
                                    <h3 *ngIf='tier.options.language === "L1" && i === 0' [innerHTML]='tier.html'></h3>
                                    <h5 *ngIf='settings.level[tier.name] && tier.options.language === "L1" && i !== 0'
                                        [innerHTML]='tier.html'></h5>
                                </div>
                            </td>
                            <td class='center-text'
                                *ngIf="settings.level['breakdown-translation'] || settings.level.translation">
                                <div *ngFor="let tier of conjugation; let i = index">
                                    <h3 *ngIf='settings.level[tier.name] && tier.options.language === "L2" && i === 0'
                                        [innerHTML]='tier.html'></h3>
                                    <h5 *ngIf='settings.level[tier.name] && tier.options.language === "L2" && i !== 0'
                                        [innerHTML]='tier.html'></h5>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>